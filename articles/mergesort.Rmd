---
title: "Mergesort"
output: html_document
---

```{r, include=FALSE}
library(tidyverse)
library(algovis)
library(ggplot2)
library(gganimate)
library(DiagrammeR)
```

## Description
Mergesort is a divide-and-conquer sorting technique, where a larger problem is recursively divided and solved at a finer granularity.
There are two main subroutines involved:

1. The `mergeSort` routine itself, where the recusive division happens.
2. A `merge` routing, which is responsible for putting all of the divided pieces back together.

<div align="center">
```{r echo=FALSE, fig.align="center"}
# TODO first level split of "SORTING" is confusing, "SOR" should be left of "TING"
# use invisible edges? see https://stackoverflow.com/questions/44274518/how-can-i-control-within-level-node-order-in-graphvizs-dot/44274606
grViz("
digraph mergesort {
  
  OR2 [label='OR'];

  subgraph cluster_divide {
    label = 'Divide';
    style = 'dotted';
    SORTING -> {SOR TING}
    SOR -> {S OR}
    TING -> {TI NG}
    OR -> {O R}
    TI -> {T I}
    NG -> {N G}
  }

  subgraph cluster_merge {
    label = 'Conquer (Merge)';
    labelloc = 'b';
    style = 'dotted';
    {O R} -> OR2
    {S OR2} -> ORS
    {T I} -> IT
    {N G} -> GN
    {IT GN} -> GINT
    {ORS GINT} -> GINORST
  }
}
")
```
<div>



```{r plot-mergesort, fig.align='center', message=FALSE, echo=FALSE}
set.seed(0)
test_vector <- runif(25) * 10
sorting_snapshots <- mergeSortSnapshot(test_vector) %>% rename_all(function(x) {str_extract(x, "[0-9]+")})

anim <- sorting_snapshots %>%
  pivot_longer(everything()) %>% 
  mutate(
    name = as.integer(name)
  ) %>%
  group_by(name) %>% 
  mutate(
    position = row_number()
  ) %>% 
  ggplot() + 
  aes(x = position, y = value) + 
  geom_col() + 
  theme_void() +
  transition_manual(name) +
  ggtitle('Merge Sort - Iteration #{current_frame}')
animate(anim, renderer = gifski_renderer(), fps = 5, end_pause = 5)
```
Note how portions of the vector are sorted, which are subsequently sorted again as part of a larger sub-vector.
The final sorting step occurs when the two halves of the vector are themselves sorted and merged.
This illustrates the recursive nature of the algorithm.
